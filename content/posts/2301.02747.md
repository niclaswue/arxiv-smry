---
title: "Modeling Scattering Coefficients using Self-Attentive Complex Polynomials with Image-based Representation"
date: 2023-01-06T23:32:07.000Z
author: "Andrew Cohen, Weiping Dou, Jiang Zhu, Slawomir Koziel, Peter Renner, Jan-Ove Mattsson, Xiaomeng Yang, Beidi Chen, Kevin Stone, Yuandong Tian"
weight: 2
showToc: true
TocOpen: true
draft: false
hidemeta: false
comments: false
description: "Important disclaimer: the following content is AI-generated, please make sure to fact check the presented information by reading the full paper."
disableHLJS: true # to disable highlightjs
disableShare: false
hideSummary: false
searchHidden: false
ShowReadingTime: false
ShowBreadCrumbs: false
ShowPostNavLinks: false
ShowWordCount: true
ShowRssButtonInSectionTermList: false
UseHugoToc: false
cover:
    image: "https://ik.imagekit.io/smryai/2301-02747v2_r8inI05Dr.jpg" # image path/url
    alt: "Modeling Scattering Coefficients using Self-Attentive Complex Polynomials with Image-based Representation" # alt text
    caption: "The full paper is available [here](https://arxiv.org/abs/2301.02747)." # display caption under cover
    relative: false # when using page bundles set this to true
    hidden: false # only hide on current single page
---

# Link to paper
The full paper is available [here](https://arxiv.org/abs/2301.02747).


# Abstract
- Finding antenna designs that satisfy frequency requirements and are also optimal with respect to multiple physical criteria is a critical component in designing next generation hardware
- However, such a process is non-trivial because the objective function is typically highly nonlinear and sensitive to subtle design change
- Moreover, the objective to be optimized often involves electromagnetic (EM) simulations, which is slow and expensive with commercial simulation software
- In this work, we propose a sample-efficient and accurate surrogate model, named CZP (Constant Zeros Poles), to directly estimate the scattering coefficients in the frequency domain of a given 2D planar antenna design, without using a simulator
- CZP achieves this by predicting the complex zeros and poles for the frequency response of scattering coefficients, which we have theoretically justified for any linear PDE, including Maxwell's equations
- Moreover, instead of using low-dimensional representations, CZP leverages a novel image-based representation for antenna topology inspired by the existing mesh-based EM simulation techniques, and attention-based neural network architectures
- We demonstrate experimentally that CZP not only outperforms baselines in terms of test loss, but also is able to find 2D antenna designs verifiable by commercial software with only 40k training samples, when coupling with advanced sequential search techniques like reinforcement learning.

# Paper Content

## Introduction
- This representation is used to learn a surrogate model that is more accurate and efficient than current methods.
- Our surrogate model is used to efficiently optimize antenna designs.
- Our approach is applicable to a wide range of antenna designs and can be used to learn surrogate models for other antenna properties as well.

## Antenna Preliminaries
- Define key notions and concepts
- Derive antenna design problem from traditional EM solvers
- CZP architecture is the theoretical innovation

### Antenna Parameterization
- Substrate. The rectangular printed circuitry board of width S x and height S y on which the other components sit. The substrate has thickness S z and dielectric permittivity r .
- Ground plane. A solid rectangle extending through the entire substrate in the x direction and partially in the y direction.
- Discrete port. The port location is the coordinate p x , p y and is dependent on one of the front-side metallic patches.
- Front-side metallic patches. The antenna contains M rectangular metallic patches which can freely move within the substrate area or pre-determined ranges. The m-th patch p m is defined by its width and height s m,x , s m,y and, the coordinate of the bottom left corner l m,x , l m,y . When the boundary of a metallic patch goes beyond the substrate, the excess is simply clipped. When patches overlap, there is no increase in the thickness; they combine to make a single metallic patch that is no longer rectangular.
- Combining all these specifications, we now have an overall design choice vector defined as which determines the antenna's frequency response described by the logarithm of modulus of the scattering coefficients log |S 11 (ω)|, typically expressed in decibels (dB). S 11 (ω), as a function of frequency ω, is defined as the following (Caspers, 2012):

## Network Architecture
- The proposed model uses a mesh-based image representation for antennas
- The image-based transformer architecture predicts the zeros and poles of scattering coefficients

### Image representation
- Mesh-based finite element methods underpin many of the available simulation tools in electromagnetics and other fields
- Mesh representations use the fact that an antenna's resonance characteristics are directly related to its local and global topological structure
- A model would have to cope with a naive representation (i.e. the coordinates of front-side metallic patches) by learning these spatial relationships
- Adaptive meshing enables the simulation of systems unsolvable by traditional discretization methods
- We propose a three channel image representation
- The first two channels provide the boundary locations in the x and y directions where pixel values v ∈ [0, 1] are floating point to represent the distance to the nearest pixel in the x or y directions, respectively
- For example, given the bottom left (x bl , y bl ) and top right (x tr , y tr ) floating-number coordinates of a rectangular patch, we compute the pixel indices as the floor, xbl = x bl , ȳbl = y bl , xtr = x tr , ȳtr = y tr . Then, we compute the values where v l , v r ,v b ,v t correspond to the left, right, bottom and top boundary values, respectively
- The left/bottom boundary is subtracted from 1 where as the right/top is not because the floor function has a subtly different semantic meaning between these cases; Without the loss of generality, the floor of the left/bottom boundary is not contained inside the interior of the patch whereas the floor of the right/top is.
- We chose this design as it enables sensible image dimensions (i.e. 60 × 300 for a 6mm ×30mm image with a resolution of 10 pixels to 1mm) however others are possible
- Finally, note, separating the x and y boundaries into two channels enables explicit representation of the corners of patches.
- Finally, a third channel provides the interior of the antenna as a binary image where v = 1 for all index pairs x, y such that x ∈ [x bl + 1, xtr − 1], y ∈ [ȳ bl + 1, ȳtr − 1] and v = 1. Please see Algorithm 1 for pseudocode of the process and Figure 2 for an example image. Some details are omitted such as patch dimensions which go beyond the board or overlapping patches but these are straightforwardly handled via clipping and masking.

### Surrogate Model
- augmented image with x and y coordinates
- tokenizer to generate visual tokens
- CNN to generate feature maps
- filter-based tokenizer to generate L visual tokens
- transformer encoder to generate CZP
- fully connected layers to predict zeros and poles

### Model training
- CST Microwave Studio (CST, 2021) is used as ground truth
- Eqn. 4 is used to compute estimated S 11 (ω)
- Back-propagation is used to train the model
- Shrinkage loss is used to minimize the Mean Squared Error

## Experiments
- Our proposed image representation is a significant improvement over reasonable coordinate-based inputs as well as a naive binary image input.
- The CZP formulation outperforms raw prediction when using the same transformer architecture proposed in Section 4 and the proposed image representation.
- The transformer architecture outperforms a CNN for the image representation and an MLP for coordinate based input.
- CZP generalizes well to unseen antenna designs, not only on a held-out dataset, but also as a surrogate model for designs proposed by the reinforcement learning (RL) based search procedure, as verified to meet specific resonance requirements by commercial softwares.

### Surrogate Modeling
- We use 48K total samples, uniformly sampled and simulated with CST Microwave Studio (CST, 2021)
- 90% of samples are used for training and 10% are used for testing
- From the training set, 10% are randomly sampled and used for validation
- Each experiment is run for 3 random seeds
- Appendix C provides all experimental hyperparameters
- Figure 3 illustrates the first set of experiments in which we demonstrate the effectiveness of (1) our novel image representation and (2) the proposed CZP when using the transformer architecture
- To show (1), we compare against a coordinate-based method which concatenates the normalized bottom-left x, y coordinate of each patch with a onehot vector to distinguish between patches
- When using the transformer architecture, this generates 5 tokens, each with dimension 7
- Before being processed by the transformer, each token is projected into a 256 dimensional vector by a 2-layer MLP with hidden layer of width 256
- Additionally, to demonstrate (2), for both coordinate and image input, we compare against directly predicting the raw 69 dimensional frequency response with a fully connected layer, referred to as Raw in figures
- Additionally, we ablate over different degree K of CZP with values 8, 12, 16, 20 and the number of attention layers L with values 8, 6, 4, 2
- First, within each configuration, the image representation improves over its coordinate counterpart by a minimum of 9.6% with L = 4 and raw prediction and a maximum of 26.8% with L = 2 and K = 12
- Second, for the image representation, CZP improves over raw prediction by a minimum of 9.2% with L = 8 and K = 12 and a maximum of 28.0% with L = 2 and K = 12
- For the coordinate representation, CZP improves over raw prediction by a minimum of 4.6% with L = 8 and K = 12 and a maximum of 25.1% with L = 2 and K = 8
- Increasing the transformer depth from 2 to 8 layers improves raw prediction for image and coordinate representations by 29.5% and 35.9%, respectively
- Increased depth improves the CZP an average of 15.4% and 20.9% for image and coordinate representations, respectively
- In Figure 4, we provide results for 4 other baselines to show the impact of the transformer and image representation over reasonable alternatives
- In Figure 5, we provide a data ablation with raw prediction and CZP K = 20
- The trend of CZP out performing raw prediction holds in this setting as well although the differences in test loss are small
- However, in the next section, we show that our model greatly outperforms the baselines when used for optimization when trained with less data, more robust for unseen designs

### Optimization
- The proposed model can be used by an optimization procedure to find antenna configurations that have specific resonance characteristics
- In this problem, the frequency ranges are 2.4 GHz-2.5 GHz and 5.1 GHz-7.0GHz and the target thresholds are t
- Formal, we define the state and action of the Markov Decision Process (MDP) (Puterman, 1994) as: • State: A one-hot identifier and (x, y) coordinates of the bottom left corner of the patches which have been placed and a one-hot vector for the next patch to be placed. • Action: (x, y) coordinates of the bottom-left corner of the next patch to be placed. where the subscripts correspond to list slicing. The sum r = r [2.4−2.5] +min(1.0, r [5.1−7.0] ) is then the reward given at the final timestep and at all previous timesteps the reward is zero. Note, we prevent the second reward component from being greater than 1.0 because in experiments the higher band (5.1 GHz-7.0 GHz) seemed to be easier to optimize and often led to local minima that did not optimize the lower band (2.4 GHz-2.5 GHz).
- To optimize, we use the implementation of Soft Actor Critic (SAC) (Haarnoja et al., 2018) from Stable-Baselines3 (Raffin et al., 2021) and build the environment using the Gym API (Brockman et al., 2016). Default hyperparameters are used except we perform two updates at the end of each episode as opposed to one or more updates per step.
- For each of the 3 seeds for each architecture trained in the previous section, we run 3 seeds of RL optimization for a total of 9 experiments per configuration. In each experiment, we deploy the SAC agent
- In Figure 6, we provide examples in columns (a) and (b), respectively, of the found antenna configuration and the frequency responses predicted by the model (red) and the CST simulation (green). However, in terms of success rate (i.e., how many configurations or optimization runs actually produce an antenna which meets the constraints), CZP significantly out per-forms raw prediction. Specifically, in Figure 7, we provide the percentage of the top 3 configurations (i.e., 3 per seed for a total of 27) found over all seeds which meet the constraints and also the percentage of runs where any of the top 3 meet the constraints. Additionally, we perform a data ablation to show that CZP is more robust to less data demonstrating its strength as an inductive bias.

## Conclusion
- Derived a theoretical form for the S 11 scatter coefficients based on which proposed the CZP network architecture
- Proposed a novel image representation inspired by existing mesh-based simulation techniques
- Demonstrated experimentally that the proposed model and image representation are significant advances through architecture and data ablation studies
- Had significantly higher utility in terms of success rate for optimization of antenna design than baselines

## B. Specification of the Design Space
- Dimensions of the patches are (0.75, 5.49), (17.64, 1.7), (11.38, 3.0), (18.63, 0.56), (0.99, 2.43)
- Ranges of the location of each patch are (0, 10), (0.5, 0.5), (10, 18.62), (11.37, 3.57), (18, 62), (29.01, 3.57)
- Patch that determines the discrete port is p 1

## C. Experimental details
