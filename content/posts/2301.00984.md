---
title: "Protein-Ligand Complex Generator & Drug Screening via Tiered Tensor Transform"
date: 2023-01-03T07:33:20.000Z
author: "Jonathan P. Mailoa, Zhaofeng Ye, Jiezhong Qiu, Chang-Yu Hsieh, Shengyu Zhang"
weight: 2
showToc: true
TocOpen: true
draft: false
hidemeta: false
comments: false
description: "Important disclaimer: the following content is AI-generated, please make sure to fact check the presented information by reading the full paper."
disableHLJS: true # to disable highlightjs
disableShare: false
hideSummary: false
searchHidden: false
ShowReadingTime: false
ShowBreadCrumbs: false
ShowPostNavLinks: false
ShowWordCount: true
ShowRssButtonInSectionTermList: false
UseHugoToc: false
cover:
    image: "https://ik.imagekit.io/smryai/2301-00984v1_xnH-LS_IY.jpg" # image path/url
    alt: "Protein-Ligand Complex Generator & Drug Screening via Tiered Tensor Transform" # alt text
    caption: "The full paper is available [here](https://arxiv.org/abs/2301.00984)." # display caption under cover
    relative: false # when using page bundles set this to true
    hidden: false # only hide on current single page
---

# Link to paper
The full paper is available [here](https://arxiv.org/abs/2301.00984).


# Abstract
- Accurate determination of a small molecule candidate (ligand) binding pose in its target protein pocket is important for computer-aided drug discovery
- Typical rigid-body docking methods ignore the pocket flexibility of protein, while the more accurate pose generation using molecular dynamics is hindered by slow protein dynamics
- We develop a tiered tensor transform (3T) algorithm to rapidly generate diverse protein-ligand complex conformations for both pose and affinity estimation in drug screening, requiring neither machine learning training nor lengthy dynamics computation, while maintaining both coarse-grain-like coordinated protein dynamics and atomistic-level details of the complex pocket
- The 3T conformation structures we generate are closer to experimental co-crystal structures than those generated by docking software, and more importantly achieve significantly higher accuracy in active ligand classification than traditional ensemble docking using hundreds of experimental protein conformations.

# Paper Content

## Introduction
- Structure generation capability is even more prevalent and important for drug discovery applications
- Recent development in the deep learning community has enabled generative model algorithms to more accurately predict single protein structures
- Targeting a specific pocket of a protein with a ligand poses an additional challenge because the compound is composed of multiple interacting structures
- Finding the binding pose of a flexible ligand molecule when it is docked onto a flexible protein receptor pocket is a daunting task due to the degree of flexibilities built onto this two-system complex
- The most common method (with lower computational cost) is to freeze the target protein receptor pocket and use a docking software such as AutoDock Vina, Smina, and Glide to attach the ligand molecule onto the rigid protein pocket and generate multiple candidate ligand docking poses
- Unfortunately it is known that ligands docked onto a rigid protein pocket are not representative of how ligands look like in a real protein-ligand complex and are difficult to use for active ligand classification
- The state-of-the-art solution to this problem is to perform ensemble docking, where multiple structures of the same protein pocket (usually 10 2 -10 3 structures) are either obtained experimentally or generated through long molecular dynamics simulations (MD with millisecond-long simulations, which correspond to ~10 12 MD time steps)
- and other generative methods; the ligands of interest are then docked to all these protein structures to generate multiple conformations of protein-ligand complexes.
- It is worth noting that the protein structure generation is done with no regard to the specific ligand existence in the protein pocket, as it remains difficult to simultaneously modify the protein and ligand structures due to the combined degree of flexibilities in the protein-ligand complex.
- To the best of the authors' knowledge, MD simulation of the entire protein-ligand complex structure remains the only reliable way to sample and generate diverse complex conformations of entire protein-ligand pockets.
- Unfortunately, it is computationally expensive to do so due to the slow dynamics of the protein, and this kind of process is usually reserved for the last step of a drug screening workflow such as the free energy perturbation (FEP) approach, where 2-4 ligands can be scored per day on a 4-GPU server
- although there is an attempt to do this over larger scale for the initial screening steps.
- Structure generation capability is even more prevalent and important for drug discovery applications
- Recent development in the deep learning community has enabled generative model algorithms to more accurately predict single protein structures
- Targeting a specific pocket of a protein with a ligand poses an additional challenge because the compound is composed of multiple interacting structures
- Finding the binding pose of a flexible ligand molecule when it is docked onto a flexible protein receptor pocket is a daunting task due to the degree of flexibilities built onto this two-system complex
- The most common method (with lower computational cost) is to freeze the target protein receptor pocket and use a docking software such as AutoDock Vina, Smina, and Glide to attach the ligand molecule onto the rigid protein pocket and generate multiple candidate ligand docking poses
- Unfortunately it is known that ligands docked onto a rigid protein pocket are not representative of how ligands look like in a real protein-ligand complex and are difficult to use for active ligand classification
- The state-of-the-art solution to this problem is to perform ensemble docking, where multiple structures of the same protein pocket (usually 10 2 -10 3 structures) are either obtained experimentally or generated through long molecular dynamics simulations (MD with millisecond-long simulations, which correspond to ~10 12 MD time steps)
- and other generative methods; the ligands of interest are then docked to all these protein structures to generate multiple conformations of protein-ligand complexes.
- It is worth noting that the protein structure generation is done with no regard to the specific ligand existence in the protein pocket, as it remains difficult to simultaneously modify the protein and ligand structures due to the combined degree of flexibilities in the protein-ligand complex.
- To the best of the authors' knowledge, MD simulation of the entire protein-ligand complex structure remains the only reliable way to sample and generate diverse complex conformations of entire protein-ligand pockets.
- Unfortunately, it is computationally expensive to do so due to the slow dynamics of the protein, and this kind of process is usually reserved for the last step of a drug screening workflow such as the free energy perturbation (FEP) approach, where 2-4 ligands can be scored...

## Results & Discussion

## Tiered Tensor Transform Algorithm

## Evaluation of Generated Protein-Ligand Pocket Structures
- For the conformation structure generation quality assessment, we compare these 3T structures with available experimental co-crystal structures for specific protein-ligand complexes.
- In this work, we generate 3T protein-ligand complex conformations for three different proteins: CDK2, HSP90, and FXa.
- CDK2 pocket is a flexible deep hydrophobic cavity, HSP90 pocket is surrounded with two long alpha helixes which are known to take several major conformation changes upon different ligand binding, 59 while FXa active site is a flexible shallow hydrophobic groove.
- For each of these proteins, we extract one protein structure example from the Protein Data Bank (PDB): 1fin, 1uyg, and 1ezq respectively.
- We first perform individual cross-docking structural analysis on 3T-generated CDK2 conformations as an example.
- The ligand from 4ez3 PDB co-crystal structure is cross-docked onto our 1fin protein using smina 32 to obtain the initial structure.
- We calculate the root mean squared displacement (RMSD, 39 see Methods) of this cross-docked ligand when compared to the original 1fin co-crystal ligand, producing   = 3.89 Å.
- The larger this value is, the farther the predicted cross-docked structure is from the real co-crystal.
- We then transform this initial structure through 3T (see Methods), producing new protein-ligand complex conformation.
- It can be seen from Figure 3b that the 3T ligand conformation matches the original 1fin co-crystal ligand conformation better than the initial structure, with smaller  3 = 1.86 Å and protein binding sites which are more correctly attached to the ligand compared to the initial smina structure with the rigid 1fin protein.
- We correspondingly have RMSD improvement Δ =   −  3 = 2.03 Å .
- This improvement is induced by protein backbone conformation change (red circle), which becomes closer to the actual 4ezq co-crystal protein and pushes on the ligand slightly, and can be seen in more detail in Supplementary Figure 3a.
- We further analyse our 3T CDK2 protein conformations compared to what will be found across known co-crystal structures as well as MD simulations.
- 373 co-crystal CDK2 protein structures are extracted from the PDB website.
- 500 protein structures are extracted every 1 ns interval from an MD simulation of the 1fin protein-ligand structure in water (see Methods).
- Finally, 90 protein structures are extracted from 3T-generated structures originating from 1fin smina re-docked initial structures (new conformations can be generated by simply changing the random number seed of 3T energetic kick).
- Principal component analysis (PCA) of the protein backbone is commonly used to assess protein conformation diversity, 60 and is shown in  Individual structures (grey: initial, magenta: 3T, green: co-crystal) are available for clarity purposes, showing that 3T structure has a smaller RMSD and a better match (ligand pose and protein binding sites) with the experimental co-crystal.
- CDK2 protein backbone micro-state comparison using PCA for 3T-generated structures (re-docking of 1fin PDB) compared to 1fin pocket structures generated using 500 ns protein-ligand complex MD and to all known experimental CDK2 co-crystal structures.
- The MD only occupies a fraction of the entire CDK2 PC sub-space because there are several major liganddependent protein conformations available for CDK2.
- 3T correctly occupies only the sub-space corresponding to that of 1fin MD and does not occupy the remaining subspace which are not physically accessible by 1fin protein-ligand complex.
- The experimental 1fin co-crystal structure is shown as the black star.

## Applicability in Active Ligand Classification
- It has recently been shown that docking potential drug candidate ligand molecules onto a single rigid protein pocket is insufficient for the purpose of active ligand classification.
- In fact, the ligands need to be docked onto hundreds of distinct rigid conformations of the target protein pocket.
- Simple docking score evaluation is insufficient and an ML model needs to be built on top of the ensemble docking scores to obtain a decent active ligand classifier.
- These varieties of protein conformation structures are difficult or expensive to obtain, and hence ligand (A) is often docked onto non-matching rigid protein structure (B) taken from a different experimental protein-ligand (B-C) complex, or onto rigid protein structure (D) generated from lengthy MD of the protein pocket in a solvent.
- On the other hand, the 3T structure generation enables us to generate ligand-dependent protein-ligand complex pocket conformations explicitly tailored to each protein-ligand pair.
- We demonstrate this versatility by performing ML-assisted "ensemble docking" similar to that performed by Ricci-Lopez et al.
- In the prior work, ligand docking was performed onto different number of rigid protein structures depending on the dataset (CDK2: 402, HSP90: 64, FXa: 136). In this work, we simply generate ten 3T conformation structures for each ligand docked onto one rigid protein of CDK2, HSP90, and FXa each.
- We adopt the identical procedure of 30×4-fold cross validation (30×4cv) and gradient boosting trees (GBT) classifier algorithm which was used in prior work to ensure that we only compare the conformation feature quality and not the classification method being used.
- We also note that 3T generates not only the protein-ligand complex pocket conformations, but also the potential energy landscape surrounding the local energy minimum during its structure optimization procedure which can be used as additional features.

## b-d)
- The classification metric is shown for different number of CDK2, HSP90 and FXa pocket conformations respectively.
- Similarly, the AUC-ROC metric is shown in e-g).
- The three proteins differ in structure flexibility, with CDK2 and FXa being dominated by flexible loops and HSP90 being dominated by alpha helixes and beta sheets.
- We see that the features from ten 3T ligand-dependent pocket conformations generated from one experimental protein conformation are equivalent or better than features from significantly larger number of rigid experimental X-ray diffraction protein conformations (rigid XRD) or simulated MD conformations (rigid MD).

## Protein
- To enable fair comparison with existing work and direct comparison between different dataset sample distributions, we use the metric area under the curve -receiver operating characteristics (AUC-ROC) and normalized enrichment factor   =  (, ) ⁄ where  is the total number of ligands in the dataset,  is the top fraction of the ranked ligands to be selected (set to  =   =  ⁄ ),  is the total number of true active ligands, and   is the total number of the chosen  ligands which are true active ligands.
- As we would like to investigate how useful our protein-ligand complex pocket conformations are compared to experimentally obtained protein conformations, we re-calculate    of the prior work    for the three proteins for different number of rigid experimental X-ray diffraction protein conformation hosts (rigid XRD).
- In addition, we also perform long MD of the proteins in water, extract the structures as shared rigid protein hosts for all of the ligand dockings, and calculate the corresponding classification metric for this MD-based reference (rigid MD) similar to another prior work.
- We note that these MD structures are not ligand-dependent because performing individual MD for each explicit protein-ligand pair (holo-MD) in this work will be computationally prohibitive.
- The AUC-ROC result supporting our hypothesis is shown in Figure 5b, where we show that an 'ensemble-docking' CDK2 active ligand classifier built using ten 3T proteinligand complex conformations significantly outperforms an ensemble-docking CDK2 active ligand classifiers built using either 402 rigid protein conformation hosts (both rigid MD and rigid XRD).
- We similarly outperform 64 HSP90 and 136 FXa rigid protein conformation classifiers using our respective ten 3T conformations (Figure 5c-d, Table 2).
- These classifiers'    metrics are consistent with AUC-ROC metrics (Figure 5e-g) showing 3T conformations significantly outperforming their rigid conformation counterparts, further demonstrating the classification utility of our 3T conformations.
- The performance improvement is especially big for HSP90, which is the least flexible protein pocket structure among the three.
- We also show that constraining or eliminating protein structures' flexibility during the 3T conformation generation will significantly degrade 3T classifier performance (Supplementary Figure 6, Supplementary Table 2).
- While it may seem non-intuitive that a classifier built with the number of conformation structures  ,3 = 10 which originates from   = 1 protein host conformation structure achieves similar or better classification results than a classifier built using a large number of experimental protein host conformation structures (  = 64-402), we note that the 3T structures are liganddependent and their features contain more information (Methods).
- We further note that while 3T conformations are unique and random for each ligand (making classifier feature usage more difficult to justify), we mitigate this problem by ensuring that the same 3T random seed is used across different ligands. This means the ligands share almost identical initial protein structural distortion during the 3T energetic kick process, before the structures get relaxed into their final protein-ligand complex conformation geometries.
- Finally, we note that 3T classifiers with  ,3 = 4 is in fact enough to outperform both rigid MD and rigid XRD-based classifiers (Supplementary Figure 7).

## Conclusions
- The algorithm generates realistic complex multi-scale structures
- The structure generation works by using a combination of one example initial structure and a differentiable structure

## Methods

## Ligand Structure Collection
- The 3D ligand structures for the "COCRY" dataset come from Protein Data Bank 1
- For these downloaded pdb files, all the water and solvent molecules were removed
- Then, all these co-crystal structures are aligned to a reference protein structure (1fin in CDK2, 1uyg in HSP90 and in FXA)
- The natural ligands were then extracted to get the "COCRY" dataset
- The small molecules other than the "COCRY" dataset come from several sources (DUD-E, DEKOIS 2.0 and CSAR) as described in the work of Ricci-Lopez et al.

## Input Structure Preparation
- A single protein conformation structure is obtained from the Protein Data Bank
- The ligand molecules are then docked onto the rigid protein using smina 6 with parameters of "-scoring=vinardo -factor=100 -num_modes=5 -exhaustiveness=16"
- The docked ligand is then extracted onto a standalone mol2 file
- Secondary structure, residue name and rotatable bond information are extracted from the pdb and mol2 files using PyMol (v2.5), OpenBabel (v3.1.1) and RDKit (v2020.09.1.0)
- The protein pdb is assigned CHARMM force field 9 using the GROMACS software 10 and converted into protein gro file
- Similarly, CHARMM-style force field is assigned onto the ligand mol2 file using SwissParam webserver
- They are then combined onto one protein-ligand complex gro file (with complete CHARMM force field) and further converted into the LAMMPS input data format 12 using a custom version of the InterMol software 13 with some bug fixes
- This LAMMPS input data format can be directly loaded onto our 3T PyTorch model for eventual atomistic force field energy (structure evaluation cost function) calculation

## 3T PyTorch Model Development and Structure Generation
- The 3T structure generation algorithm is implemented using the autograd functionality of PyTorch
- Some of the protein micro-groups such as phenylalanine, histidine, and tryptophan sidechains can be very rigid, which might introduce a very deep local structure energy minimum
- Because of that, when we detect that there is enough space for these structures (no atomic clashes within 1 Å), we apply additional 180-degree rotation on
- The generated conformations are outputted as xyz or cif files, and the cost function (energy landscape) throughout optimization was recorded
- This process was repeated 10 times using 10 different (but consistent across ligands) random number seeds during the energetic kick, to generate ten 3T conformations

## PCA for Protein Structures
- Aligned all structures to reference structures
- Took cocrystal protein conformations from all available PDB's
- Took MD conformations from a holo-MD simulation of the protein-ligand structures
- Generated 90 3T conformations
- Extracted (x,y,z) coordinates of the protein backbone alpha carbon atoms in the pockets
- Fitted scikit-learn PCA models (n_component=2)
- Transformed MD and 3T data
- Plotted principle components PC1 and PC2

## 𝚫𝚫𝑹𝑹𝑹𝑹𝑹𝑹𝑹𝑹 Calculation
- The ten 3T conformations are scored using smina scoring function.
- Three pocket structures with the lowest docking scores are chosen as our best candidates, which are then aligned to the corresponding experimental co-crystals using PyMol based on the pocket atoms of the proteins, and the ligand RMSD is calculated with spyrmsd packages.
- The best RMSD of the three aligned pocket structures is then compared to the initial smina pose' RMSD (similarly aligned to the experimental cocrystal).
- We also test how significant is the hypothesis that 〈  −  3 〉 = 〈Δ〉 > 0 on average, calculating the p-value using the scipy's stats package.

## Active Ligand Classification
- The recorded 3T formation energies (2200 steps for each conformation) are down sampled by 100 and scaled down by 1000 (to better match the unit of the docking scores), producing 22 energy features per conformation.
- The docking scores associated with initial structure, ligand-relaxed structure, and the 10 conformations are also included as features (12 features), resulting in a total of 232 features per ligand.
- These features are directly used as GBT-based 30×4cv active ligand classifier input, using the same Jupyter notebook available from previous work for AUC-ROC and    calculations.

## Molecular Dynamics Setup and Semi-Flexible Docking Computation Resource Estimation
- GPU machine: one NVIDIA T4 card
- CPU machine: 16 cores on a 48-core AMD EPYC 7K62 processor
- Semi-flexible Smina docking: done using parameters "--scoring=vinardo --factor=100 --num_modes=3 -exhaustiveness=16 --flexdist=4 --flexdist_ligand=ref_ligand.sdf"
- rDock: parameter "RECEPTOR_FLEX=4" is used in the PRMFILE and "-n=64" is used for docking
- MD computation: GROMACS protein-ligand structure above is solvated in water and the system is charge-neutralized and minimized before subsequent NVT and NPT equilibrations
- GROMACS production MD speed (NPT, 2.0 fs time step at temperature of 300 K): it is estimated that 1 µs to 1 ms MD time is needed to obtain enough protein structural diversity
- The required GPU computation cost is then calculated accordingly.

## Unnamed Section 282
- Initial protein-ligand pocket volume definition
- 3T energetic kick and optimization in the tiered tensor transform parameter hyperspace
- Protein-ligand pocket structures generated by 3T, compared to the initial docked structure and the corresponding experimental protein-ligand co-crystal structure

## Unnamed Section 283
- The 3T scheme separates protein-ligand complexes into fixed and movable atoms
- Movable atoms undergo several layers of multi-scale hierarchical tensor transformations

## Unnamed Section 284
- 2000 backward propagation steps are used to generate the final 3T structures
- The computation-wise process of generating the final 3T structures looks like a standard deep learning training process, with no classification label or regression target in its cost function

## Unnamed Section 285
- Figure 3c shows that the co-crystal structures span a much more diverse range of protein backbone conformations due to the diverse set of co-crystal ligand chemistry geometries found in nature.
- The principal components (PC) of ligandspecific conformations from the MD occupies a fraction of the co-crystal PC sub-space, and crucially the ligand-specific PC from 3T-generated conformations occupy mostly the MD conformations' PC sub-space outside of the irrelevant general co-crystal PC sub-space. This shows that 3T protein conformations are ligand-induced and more specific compared to general protein-ligand co-crystal structures.
- 3T final structures rely on energy minimization scheme, so it does not occupy the entire PC space of the 1fin MD conformations which is done at the room-temperature.

## Unnamed Section 286
- Example of ligand-dependent pocket conformations for three protein structures generated in this work
- Overlaid visual comparison of cross-docking on CDK2 protein structure(ligand structure from 4ez3 PDB cross-docked on protein structure from 1fin PDB) using 3T and standard rigid protein docking, compared to the ground truth 4ez3 co-crystal structure
- The red circle indicates the protein backbone which is correctly transformed by 3T and has become significantly more similar to the co-crystal, which is then responsible for pushing the cross-docked 3T ligand closer to experimental co-crystal ligand pose compared to the initial cross-docked structure

## Unnamed Section 287
- Workflow of the Δ calculation process, starting with initial smina cross-docking, followed by 3T structure transformation and RMSD analysis, generating   ,  3 , and Δ =   −  3
- Distribution of ligand Δ for generated CDK2 protein pockets, with Δ > 0 indicating ligand pose improvement over docking software ligand pose
- Scatterplot of   split based on the sign of Δ, with diagonal line indicating the physical limit of Δ
- Bar plot showingthe average of Δ for all ligand poses with Δ > 0, indicating that 3T increasingly generates better poses if the initial pose is less optimal (large   )
- Bar plot showing the average of Δ for ligand poses with Δ ≤ 0, indicating that more negative Δ becomes more likely when the initial pose is already very close to the experimental co-crystal structure (small   )

## Unnamed Section 288
- 3T conformation feature extraction process (pocket cross-docking scores and formation energies Δ)
- 30× 4-fold cross validation (with GBT classifier)

## Unnamed Section 289
- hr / 22.7 CPU-hr * 69k atoms for the CDK2 protein in water  GROMACS GPU speed = 110.5 ns/day

## Unnamed Section 290
- The 3T model is a deep learning model that doesn't use any machine learning or training data.
- The 3T model is split into two parts, with the first being the hierarchical tensor transformation module where structural transformation happens and the second being the structure -force field energy calculation module.
- LAMMPS force field styles which are generated by InterMol are re-implemented in the 3T PyTorch model to enable native 'training-like' PyTorch structure generation.
- Adam optimizer 15 and multi-step learning rate scheduler are used.
- In the beginning, 200 optimizer steps are used to relax the ligand structure in the pocket. Then the entire movable protein-ligand pocket (within   ) experiences 3T energetic kick, followed by 2000 3T optimizer steps.

## Unnamed Section 291

## Unnamed Section 292

## Unnamed Section 293

## Unnamed Section 294

## Unnamed Section 295

## Unnamed Section 296

## Unnamed Section 297

## Unnamed Section 298
- Bar plot binning is done every 1Å interval.
- Bar plot binning is used to improve the resolution of the data.
- Bar plot binning is used to improve the accuracy of the data.

## Unnamed Section 299
- The evaluation cost function helps to find the best protein-ligand complexes
- A hierarchical multi-scale tensor transformation sequence helps to generate unique protein-ligand complexes
- A random energetic kick helps to create initial structural distortion in the protein-ligand complexes
